---
# Basic Setup of MySQL

#- name: Change mysqld.cnf to listen on all interfaces
#  shell: |
#    sed -i "s/^\(bind-address\s*=\s*\).*\$/\10.0.0.0/" /etc/mysql/mysql.conf.d/mysqld.cnf
#  become: yes

- name: Install required packages
  dnf:
    name:
      - mariadb-server
      - python3-PyMySQL
    state: latest

- name: Ensure mariadb service is running
  systemd:
    name: mariadb
    state: started
    enabled: yes

- name: Set mariadb root password
  mysql_user:
    login_user: root
    login_password: {{ dbpassword }} 
    user: root
    check_implicit_admin: true
    password: {{ dbpassword }}
    host: localhost

- name: Create wordpress database on the server
  mysql_db:
    name: wordpress
    login_user: root
    #login_unix_socket: /var/run/mysqld/mysqld.sock
    state: present

- name: Create wordpress user
  mysql_user:
    login_user: root
    #login_unix_socket: /var/run/mysqld/mysqld.sock
    name: wpuser
    password: "{{ dbpassword }}"
    priv: 'wordpress.*:ALL,GRANT'
    host: '%'
    state: present
